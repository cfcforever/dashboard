---
title: "Today's Electricity Consumption"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, error = FALSE,
                      fig.width = 10, fig.height = 4)
``` 

```{r}
library(lubridate)
library(reshape2)
library(dplyr)
library(ggplot2)
library(plotly)
```

```{r}
# load data
data <- read.csv("data/electricity_2014_2022.csv")

data <- data %>%
  mutate(Year = year(date), Month = month(date), Day = day(date))

# select the data of 2022-12
data_filtered <- data %>%
  filter(Year == 2022, Month == 12, Day == 31)

data_filtered = melt(data_filtered, measure.vars = c("chambre", "consultation", "bureau"))
data_filtered = data_filtered %>%
  rename(facility = variable) %>%
  rename(electricity = value)
```


```{r eval=FALSE, fig.height=9, fig.width=9, include=FALSE}
# ggplot2 for histogram
p <- ggplot(data_filtered, aes(x = hour, y = electricity, fill = facility)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~facility, ncol = 1) +
  labs(x = "Hour", y = "Electricity (kWh)", title = "2022-12-31") +
  theme_minimal()

# using plotly
p <- ggplotly(p)

# plot
p
```


# 2022-12-31 {.tabset .tabset-pills}
## chambre
```{r}
temp = data_filtered %>% 
    filter(facility == "chambre")

p <- ggplot(temp, aes(x = hour, y = electricity)) +
  geom_bar(stat = "identity", position = "dodge", fill = "red") +
  labs(x = "Hour", y = "Electricity (kWh)", title = "") +
  theme_minimal()
p <- ggplotly(p)

p  
```

## consultation
```{r}
temp = data_filtered %>% 
    filter(facility == "consultation")

p <- ggplot(temp, aes(x = hour, y = electricity)) +
  geom_bar(stat = "identity", position = "dodge", fill = "green") +
  labs(x = "Hour", y = "Electricity (kWh)", title = "") +
  theme_minimal()
p <- ggplotly(p)

p  
```

## bureau
```{r}
temp = data_filtered %>% 
    filter(facility == "bureau")

p <- ggplot(temp, aes(x = hour, y = electricity)) +
  geom_bar(stat = "identity", position = "dodge", fill = "blue") +
  labs(x = "Hour", y = "Electricity (kWh)", title = "") +
  theme_minimal()
p <- ggplotly(p)

p  
```
